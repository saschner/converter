<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Locally Convert ‚Äî Images to Excel (Private, In-Browser)</title>
  <meta name="description" content="Locally convert IMAGE to CSV in your browser. 100% private ‚Äî nothing uploaded.">
  <meta name="robots" content="index,follow">
  <img src="convert.com">

  <style>
    :root{
      --bg1:#e1f1ff; --bg2:#f9fcff;
      --card:#fff; --border:#dfeaf6; --text:#1d2a38; --muted:#6a86a7;
      --green:#6bd68e; --red:#ff7b6a; --yellow:#ffd166;
      --shadow:0 8px 24px rgba(28,53,84,.10); --radius:18px;
    }
    html,body{
      margin:0;padding:0;
      background: radial-gradient(circle at top, var(--bg1), var(--bg2));
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      color:var(--text);
    }
    .wrap{max-width:1060px;margin:40px auto;padding:0 20px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px;}
    h1{margin:0 0 6px;font-size:36px;font-weight:800;letter-spacing:.2px;}
    .lede{margin:0 0 18px;color:var(--muted);font-size:16px;}

    /* upload block (HALF HEIGHT) */
    .drop{
      border:2px dashed #c8d9ee;border-radius:14px;
      padding:11px;                 /* was 22px */
      text-align:center;color:#6a86a7;background:#f7fbff;
    }
    .drop input{display:none;}
    .dz-btn{display:inline-flex;align-items:center;gap:.5rem;border:1px solid #cfe1f7;background:#e9f4ff;color:#27537a;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;}
    .tip{margin-top:6px;font-size:13px;color:#6a86a7;text-align:center;}

    /* controls row */
    .controls{display:flex;flex-wrap:wrap;gap:.8rem;align-items:center;margin:16px 0 12px;justify-content:center;}
    .pill{background:#eef6ff;border:1px solid #d8e7fb;color:#2c4668;padding:6px 12px;border-radius:999px;font-size:14px;}
    .quiet{color:#6a86a7;font-size:14px;}

    /* buttons ‚Äî centered */
    .button-row{display:flex;flex-wrap:wrap;gap:.8rem;margin:10px 0 18px;justify-content:center;}
    button{border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;box-shadow:0 2px 0 rgba(0,0,0,.08)}
    #convertButton{background:var(--green);color:#0c3c20;}
    #downloadCsvButton{background:#eef3f8;color:var(--text);}
    #buyCreditsBtn{background:var(--red);color:#3a0e0b;}
    #coffeeButton{background:var(--yellow);color:#4a3a00;}

    /* previews grid ‚Äî guaranteed spacing */
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      column-gap:12px;
      row-gap:12px;
      margin-top:12px;
    }
    .grid > div{display:flex;flex-direction:column;}
    .grid h3{margin:8px 0;}

    /* PREVIEW WINDOWS HALF HEIGHT */
    textarea{
      flex:1;width:100%;
      min-height:110px;              /* was 220px */
      border-radius:12px;border:1px solid var(--border);
      background:#fbfdff;color:var(--text);
      padding:12px; resize:vertical; box-sizing:border-box; margin:0;
    }

    /* credit pill variants (kept from your file) */
    #creditsBadge{
      display:inline-flex; align-items:center; gap:.4rem;
      padding:6px 12px; border-radius:999px; font-size:14px; font-weight:600;
      line-height:1; border:1px solid;
      box-shadow: inset 0 -1px 0 rgba(0,0,0,.05), 0 1px 2px rgba(0,0,0,.04);
    }
    .credit--zero{ background:#fdebec; border-color:#f3c4c8; color:#611a1c; }
    .credit--low{  background:#fff7e6; border-color:#f7e0b8; color:#5a3b00; }
    .credit--ok{   background:#e9fbf1; border-color:#bfe8cd; color:#0c3c20; }

    /* badges / graphics */
    .badges{display:flex;justify-content:center;gap:24px;margin-top:18px;}
    .badges img{height:64px;width:auto;display:block;filter: drop-shadow(0 2px 6px rgba(0,0,0,.08));}

    footer{margin-top:16px;text-align:center;color:#7a91aa;font-size:13px;}
    @media (max-width:900px){ .grid{grid-template-columns:1fr;} }
<head>
  /* === Size controls for the dropzone + both preview windows === */
:root{
  /* TUNE THESE */
  --pane-width: 360px;   /* width of each OCR/CSV pane (try 340‚Äì420) */
  --pane-height: 90px;   /* height of each textarea (try 80‚Äì140) */
  --pane-gap: 12px;      /* space between the panes */
}

/* Make the two preview columns use a fixed target width and center them */
.grid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, var(--pane-width)));
  justify-content: center;   /* center the two panes */
  gap: var(--pane-gap);
  margin-top: 12px;
}

/* ===== FINAL SIZE/FLOW OVERRIDE ===== */
/* tweak these 3 dials only */
:root{
  --pane-width: 300px;   /* width of EACH preview pane (try 280‚Äì340) */
  --pane-height: 90px;   /* textarea height (try 80‚Äì140) */
  --pane-gap: 12px;      /* gap between the two panes */
}

/* keep everything boxed so gaps behave */
#mainContainer, #mainContainer * { box-sizing: border-box; }

/* Make dropzone, controls, buttons, and grid the same narrow width and centered */
#mainContainer .drop,
#mainContainer .controls,
#mainContainer .button-row,
#mainContainer .grid{
  width: calc(var(--pane-width) * 2 + var(--pane-gap)) !important;
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
}

/* Dropzone: smaller */
#mainContainer .drop{
  padding: 6px !important;   /* shrink the big bubble */
}
#mainContainer .dz-btn{
  padding: 6px 10px !important;
  font-size: 14px !important;
}

/* Force the two preview panes to be horizontal (side-by-side) */
#mainContainer .grid{
  display: grid !important;
  grid-template-columns:
    minmax(0, var(--pane-width))
    minmax(0, var(--pane-width)) !important;
  gap: var(--pane-gap) !important;
  align-items: start;
}

/* Textarea size */
#mainContainer textarea{
  min-height: var(--pane-height) !important;
  padding: 8px !important;
  font-size: 13px !important;
}

/* Keep buttons centered to the same width */
#mainContainer .button-row{ justify-content: center !important; }

/* On small screens, stack nicely */
@media (max-width: 760px){
  #mainContainer .grid{ grid-template-columns: 1fr !important; width: 100% !important; }
  #mainContainer .drop, #mainContainer .controls, #mainContainer .button-row{ width: 100% !important; }
}
/* === Make the big white card smaller === */
#mainContainer{
  padding: 10px !important;  /* <= your max */
  /* match card width to the two panes + their gap + the card's padding */
  max-width: calc(var(--pane-width) * 2 + var(--pane-gap) + 20px) !important;
  margin: 24px auto !important; /* center the card */
}

/* Keep it fluid on small screens */
@media (max-width: 760px){
  #mainContainer{
    max-width: calc(100% - 20px) !important; /* 10px padding on each side */
    padding: 10px !important;
  }
}
/* === Restore your background image (only this) === */
body{
  background: 
    radial-gradient(1200px 800px at 50% -10%, rgba(255,255,255,.75), rgba(255,255,255,.75)),
    url('/images/background.png') center top / cover no-repeat !important;
}
</head>

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" align="center" id="mainContainer">

      <!-- your images: unchanged -->
      <img src="LocallyConvert.png" alt="Locally Convert"><br>
      <img src="mathlete.png" alt="Mathlete">

      <p><h3>Process images in your browser only ‚Äî nothing is uploaded. <br>Convert receipts, tables, and forms to CSV fast.</h3></p>

      <!-- Upload / Drop (half height) -->
      <div class="drop" id="dropzone">
        <input type="file" id="fileInput" accept="image/*,application/pdf"/>
        <label for="fileInput" class="dz-btn">üìÑ Choose an image or PDF</label>
        <div class="tip">Tip: For best results, use a clear, high-contrast image.</div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <span id="creditsBadge" class="pill">Credits: 0</span>
        <label style="display:inline-flex;gap:.5rem;align-items:center;">
          <input type="checkbox" id="oneSpace" checked>
          <span>Normalize spaces (1-space OCR)</span>
        </label>
        <span class="quiet">Engine: Tesseract.js</span>
      </div>

      <!-- Buttons -->
      <div class="button-row">
        <button id="convertButton">Convert to CSV</button>
        <button id="downloadCsvButton">Download CSV</button>
        <button id="buyCreditsBtn" title="Save more when you buy larger packs">Get Bulk Credits</button>
        <button id="coffeeButton" onclick="window.open('https://ko-fi.com/excelconverter','_blank')">Buy Us a Coffee! ‚òï</button>
      </div>

      <!-- Previews (half height) -->
      <div class="grid">
        <div>
          <h3>OCR Preview</h3>
          <textarea id="ocrOut" placeholder="OCR text will appear here‚Ä¶"></textarea>
          <div class="quiet">Toggle ‚Äú1-space OCR‚Äù to collapse weird spacing before conversion.</div>
        </div>
        <div>
          <h3>CSV Preview</h3>
          <textarea id="csvOut" placeholder="CSV preview will appear here‚Ä¶"></textarea>
          <div class="quiet">You can still download even if this area is long ‚Äî it‚Äôs just a preview.</div>
        </div>
      </div>

      <!-- your badge image: unchanged -->
      <div class="badges">
        <img src="/images/Gold-Shields.png" alt="Best Quality badge">
      </div>

      <footer>¬© 2025 AlphaMinds AI. All rights reserved.</footer>
    </div>
  </div>

  <!-- Tesseract.js (client-only OCR) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

  <script>
    /* Credits (always live; no disabled UI) */
    function getCredits(){ return Number(localStorage.getItem('lcCredits') || 0); }
    function setCredits(n){
      localStorage.setItem('lcCredits', String(n));
      const b=document.getElementById('creditsBadge'); if(b) b.textContent='Credits: '+n;
    }
    window.addEventListener('DOMContentLoaded', () => {
      setCredits(getCredits());
      const credited=new URLSearchParams(location.search).get('credited');
      if(credited) setTimeout(()=>alert(`Added ${credited} credits!`),0);
    });

    /* 1-space normalization */
    function normalizeOneSpace(txt){
      return txt.replace(/\s+/g,' ')
                .replace(/\s+,/g,',')
                .replace(/,\s+/g,', ')
                .trim();
    }
    function maybeNormalize(text){
      return document.getElementById('oneSpace')?.checked ? normalizeOneSpace(text) : text;
    }

    /* OCR + CSV */
    async function runOcr(file){
      if(!(window.Tesseract&&Tesseract.createWorker)) throw new Error('Tesseract.js not loaded');
      const worker=await Tesseract.createWorker('eng');
      const { data } = await worker.recognize(file);
      await worker.terminate();
      return data.text||'';
    }
    function buildCsvFromText(text){
      const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const rows=lines.map(l=>{
        const collapsed=l.replace(/\t/g,' ').replace(/\s{2,}/g,' ').trim();
        const cells=collapsed.split(' ');
        return cells.map(c=>/[",\n]/.test(c)?'"'+c.replace(/"/g,'""')+'"':c).join(',');
      });
      return rows.join('\n');
    }

    const fileInput=document.getElementById('fileInput');
    const ocrOut=document.getElementById('ocrOut');
    const csvOut=document.getElementById('csvOut');

    document.getElementById('convertButton').addEventListener('click', async () => {
      if(!fileInput?.files?.length){ alert('Please select a file first.'); return; }
      if(getCredits()<=0){ alert('You need credits to convert. Please buy a pack first.'); return; }
      try{
        const file=fileInput.files[0];
        ocrOut.value='Working‚Ä¶ (OCR happens locally in your browser)';
        const raw=await runOcr(file);
        const cleaned=maybeNormalize(raw);
        ocrOut.value=cleaned||'(No text recognized)';
        const csv=buildCsvFromText(cleaned);
        csvOut.value=csv;
        window.lastCsvBlob=new Blob([csv],{type:'text/csv'});
        setCredits(Math.max(0,getCredits()-1));
        alert('Conversion complete! You can download your CSV now.');
      }catch(e){
        console.error(e);
        alert(e.message||'Conversion failed. Try a clearer image.');
      }
    });

    document.getElementById('downloadCsvButton').addEventListener('click', () => {
      if(!window.lastCsvBlob){ alert('No CSV available yet. Convert a file first.'); return; }
      const url=URL.createObjectURL(window.lastCsvBlob);
      const a=document.createElement('a'); a.href=url; a.download='locallyconvert.csv'; a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('buyCreditsBtn').addEventListener('click', async () => {
      try{
        const pack=50; // change later if you add tiers
        const r=await fetch('/api/create-checkout-session',{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pack})
        });
        const {url,error}=await r.json();
        if(error||!url) throw new Error(error||'Checkout not configured.');
        window.location=url;
      }catch(e){ alert(e.message||'Could not start checkout.'); }
    });

    /* drag & drop nicety */
    const dz=document.getElementById('dropzone');
    ['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,e=>{e.preventDefault();dz.style.borderColor='#b1cff0';}));
    ['dragleave','drop'].forEach(ev=>dz.addEventListener(ev,e=>{e.preventDefault();dz.style.borderColor='#c8d9ee';}));
    dz.addEventListener('drop',e=>{
      const f=e.dataTransfer?.files?.[0]; if(f){ const dt=new DataTransfer(); dt.items.add(f); fileInput.files=dt.files; }
    });

</script>
</body>
</html>

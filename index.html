<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocallyConvert - Free Online File Converter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #6e8efb, #a777e3);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .conversion-bubble {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #eaeaea;
        }
        
        .conversion-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .file-drop-area {
            border: 2px dashed #a777e3;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s;
            background: rgba(167, 119, 227, 0.05);
            cursor: pointer;
        }
        
        .file-drop-area:hover {
            background: rgba(167, 119, 227, 0.1);
        }
        
        .file-drop-area i {
            font-size: 3rem;
            color: #a777e3;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .format-selectors {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        
        .format-box {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            text-align: center;
            background: #f9f9f9;
        }
        
        .format-box select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-top: 10px;
            background: white;
        }
        
        .convert-btn {
            background: linear-gradient(to right, #6e8efb, #a777e3);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(110, 142, 251, 0.4);
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(110, 142, 251, 0.5);
        }
        
        .credit-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f3f0ff;
            border-radius: 12px;
            margin-top: 15px;
        }
        
        .credit-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #6e8efb;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .free-credit-btn {
            background: linear-gradient(to right, #4cd964, #34e559);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(52, 229, 89, 0.4);
        }
        
        .free-credit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(52, 229, 89, 0.5);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .feature:hover {
            transform: translateY(-5px);
        }
        
        .feature i {
            font-size: 2.5rem;
            color: #6e8efb;
            margin-bottom: 15px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: white;
            background: linear-gradient(to right, #6e8efb, #a777e3);
            margin-top: 30px;
            border-radius: 0 0 20px 20px;
        }
        
        @media (max-width: 768px) {
            .format-selectors {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .credit-section {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LocallyConvert</h1>
            <p>Convert your files quickly and securely without uploading to the cloud</p>
        </header>
        
        <div class="main-content">
            <div class="conversion-bubble">
                <div class="conversion-area">
                    <div class="file-drop-area" id="dropZone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Drag & Drop your file here</h3>
                        <p>or</p>
                        <button class="convert-btn" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-file"></i> Browse Files
                        </button>
                        <input type="file" id="fileInput" class="file-input">
                    </div>
                    
                    <div class="format-selectors">
                        <div class="format-box">
                            <h4>Convert From</h4>
                            <select>
                                <option>PDF</option>
                                <option>DOCX</option>
                                <option>JPG</option>
                                <option>PNG</option>
                                <option>MP4</option>
                            </select>
                        </div>
                        
                        <i class="fas fa-arrow-right" style="font-size: 2rem; align-self: center; color: #a777e3;"></i>
                        
                        <div class="format-box">
                            <h4>Convert To</h4>
                            <select>
                                <option>PDF</option>
                                <option>DOCX</option>
                                <option>JPG</option>
                                <option>PNG</option>
                                <option>MP4</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="convert-btn">
                        <i class="fas fa-bolt"></i> Convert Now
                    </button>
                    
                    <div class="credit-section">
                        <div class="credit-count">
                            <i class="fas fa-coins"></i>
                            <span id="creditCount">5</span> Free Credits Available
                        </div>
                        <button class="free-credit-btn" id="getCreditsBtn">
                            <i class="fas fa-gift"></i> Get Free Credits
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="features">
                <div class="feature">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Secure Conversion</h3>
                    <p>Your files never leave your computer</p>
                </div>
                
                <div class="feature">
                    <i class="fas fa-bolt"></i>
                    <h3>Fast Processing</h3>
                    <p>Convert files in seconds</p>
                </div>
                
                <div class="feature">
                    <i class="fas fa-language"></i>
                    <h3>Multiple Formats</h3>
                    <p>Support for all popular file types</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2023 LocallyConvert.com | All rights reserved</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const creditCount = document.getElementById('creditCount');
            const getCreditsBtn = document.getElementById('getCreditsBtn');
            
            let credits = 5;
            
            // Drag and drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.style.borderColor = '#6e8efb';
                dropZone.style.backgroundColor = 'rgba(110, 142, 251, 0.1)';
            }
            
            function unhighlight() {
                dropZone.style.borderColor = '#a777e3';
                dropZone.style.backgroundColor = 'rgba(167, 119, 227, 0.05)';
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
            
            function handleFiles(files) {
                if (files.length > 0) {
                    const fileName = files[0].name;
                    dropZone.querySelector('h3').textContent = `Selected: ${fileName}`;
                    dropZone.querySelector('p').textContent = 'Drop another file or click to change';
                }
            }
            
            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });
            
            // Credit system functionality
            getCreditsBtn.addEventListener('click', function() {
                credits += 5;
                creditCount.textContent = credits;
                
                // Show confirmation message
                const originalText = getCreditsBtn.innerHTML;
                getCreditsBtn.innerHTML = '<i class="fas fa-check"></i> Credits Added!';
                getCreditsBtn.style.background = 'linear-gradient(to right, #4cd964, #34e559)';
                
                setTimeout(() => {
                    getCreditsBtn.innerHTML = originalText;
                }, 2000);
            });
            
            // Simulate conversion using a credit
            document.querySelector('.convert-btn').addEventListener('click', function() {
                if (credits > 0) {
                    credits--;
                    creditCount.textContent = credits;
                    
                    // Show converting message
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
                    this.disabled = true;
                    
                    // Simulate conversion process
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-check"></i> Conversion Complete!';
                        this.style.background = 'linear-gradient(to right, #4cd964, #34e559)';
                        
                        setTimeout(() => {
                            this.innerHTML = originalText;
                            this.disabled = false;
                            this.style.background = 'linear-gradient(to right, #6e8efb, #a777e3)';
                        }, 2000);
                    }, 2000);
                } else {
                    alert('You have no credits left. Please get more free credits to continue.');
                }
            });
        });
    </script>
</body>
</html>
    /* Buttons */
    .button-row { display: flex; flex-wrap: wrap; gap: .8rem; margin: 16px 0 12px; justify-content: center; }
    button { border: none; border-radius: 12px; padding: 12px 16px; font-weight: 700; cursor: pointer; box-shadow: 0 2px 0 rgba(0,0,0,.08); }
    #convertButton { background: var(--green); color: #0c3c20; }
    #downloadCsvButton { background: #eef3f8; color: var(--text); }
    #buyCreditsBtn { background: var(--red); color: #3a0e0b; }
    #coffeeButton { background: var(--yellow); color: #4a3a00; }

    /* Previews */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, var(--pane-width)));
      justify-content: center;
      gap: var(--pane-gap);
      margin-top: 12px;
      align-items: start;
    }
    .grid > div { display: flex; flex-direction: column; min-width: 0; } /* anti-overflow */
    .grid h3 { margin: 6px 0; }

    textarea {
      flex: 1;                /* fill column, prevents overlap */
      width: 100%;
      min-height: var(--pane-height);
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fbfdff;
      color: var(--text);
      padding: 8px;
      resize: vertical;
      font-size: 13px;
      box-sizing: border-box;
      min-width: 0;           /* anti-overflow */
      display: block;
    }

    /* Container */
    #mainContainer { padding: 10px; max-width: calc(var(--pane-width) * 2 + var(--pane-gap) + 20px); margin: 24px auto; }
    #mainContainer .drop, #mainContainer .controls, #mainContainer .button-row, #mainContainer .grid {
      width: calc(var(--pane-width) * 2 + var(--pane-gap)); max-width: 100%; margin-left: auto; margin-right: auto;
    }

    footer { margin-top: 16px; text-align: center; color: #7a91aa; font-size: 13px; }

    @media (max-width: 780px) {
      #mainContainer { max-width: calc(100% - 20px); padding: 10px; }
      #mainContainer .grid { grid-template-columns: 1fr; width: 98%; }
      #mainContainer .drop, #mainContainer .controls, #mainContainer .button-row { width: 98%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" align="center" id="mainContainer">
      <img src="convert.png" alt="Locally Convert" style="max-width: 200px;" onerror="this.style.display='none'"><img src="secret.png" alt="" style="display:inline"><br>
      <img src="mathlete3.png" alt="Mathlete" style="max-width: 250px;">

      <h4>NOTHING is uploaded - process images in your browser only.<br>Convert receipts, tables, and forms to CSV fast.</h4>

      <div class="drop" id="dropzone">
        <input type="file" id="fileInput" accept="image/*,application/pdf"/>
        <label for="fileInput" class="dz-btn">ðŸ“„ Choose an image or PDF</label>
        <div class="tip">Tip: For best results, use a clear, high-contrast image.</div>
        <div class="tip" id="fileName"></div>
      </div>

      <div class="controls">
        <span id="trialPill" class="pill pill--trial">Free trial available</span>
        <span id="creditsBadge" class="pill pill--credits" role="button" tabindex="0">Credits: 0</span>
        <label id="normalizePill" class="pill pill--option">
          <input type="checkbox" id="oneSpace" checked>
          <span>Normalize spaces</span>
        </label>
      </div>

      <div class="button-row">
        <button id="convertButton">Convert to CSV</button>
        <button id="downloadCsvButton">Download CSV</button>
        <button id="buyCreditsBtn">Get Bulk Credits</button>
        <button id="coffeeButton" onclick="window.open('https://ko-fi.com/excelconverter','_blank')">Buy Us a Coffee! â˜•</button>
      </div>

      <div class="grid">
        <div>
          <h3>OCR Preview</h3>
          <textarea id="ocrOut" placeholder="OCR text will appear hereâ€¦"></textarea>
        </div>

        <div>
          <h3>CSV Preview</h3>
          <textarea id="csvOut" placeholder="CSV preview will appear hereâ€¦"></textarea>
        </div>
      </div>

      <footer>
        <p><IMG SRC="Gold-Shields.png"><BR>Â© 2025 AlphaMinds AI. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <!-- Tesseract.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

  <script>
    /* Credits system */
    function getCredits() { return Number(localStorage.getItem('lcCredits') || 0); }
    function setCredits(n) {
      localStorage.setItem('lcCredits', String(n));
      document.getElementById('creditsBadge').textContent = 'Credits: ' + n;
    }

    window.addEventListener('DOMContentLoaded', () => {
      // give yourself 50 credits if empty
      if (getCredits() === 0) setCredits(50);
      else setCredits(getCredits());
    });

    // Shift+click credits pill to add test credits
    document.getElementById('creditsBadge').addEventListener('click', (e) => {
      if (e.shiftKey) {
        setCredits(getCredits() + 50);
        alert('Added 50 test credits.');
      }
    });

    function normalizeOneSpace(txt) {
      return txt.replace(/\s+/g, ' ')
                .replace(/\s+,/g, ',')
                .replace(/,\s+/g, ', ')
                .trim();
    }
    function maybeNormalize(text) {
      return document.getElementById('oneSpace').checked ? normalizeOneSpace(text) : text;
    }

    async function runOcr(file) {
      // Guard: PDFs not enabled in this build
      if (file.type === 'application/pdf') {
        alert('PDFs will be supported soon. Please upload a JPG/PNG image for now.');
        throw new Error('PDF not supported in this build');
      }
      const worker = await Tesseract.createWorker('eng');
      try {
        const { data } = await worker.recognize(file);
        return data.text || '';
      } finally {
        await worker.terminate();
      }
    }

    function buildCsvFromText(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      const rows = lines.map(l => {
        const collapsed = l.replace(/\t/g, ' ').replace(/\s{2,}/g, ' ').trim();
        const cells = collapsed.split(' ');
        return cells.map(c =>
          /[",\n]/.test(c) ? '"' + c.replace(/"/g, '""') + '"' : c
        ).join(',');
      });
      return rows.join('\n');
    }

    const fileInput = document.getElementById('fileInput');
    const ocrOut   = document.getElementById('ocrOut');
    const csvOut   = document.getElementById('csvOut');

    function showFileName() {
      const el = document.getElementById('fileName');
      const f = fileInput?.files?.[0];
      el.textContent = f ? `Selected: ${f.name}` : '';
    }

    async function doConvert() {
      if (!fileInput.files.length) { alert('Please select a file first.'); return; }
      if (getCredits() <= 0) { alert('You need credits to convert.'); return; }
      const file = fileInput.files[0];
      ocrOut.value = 'Workingâ€¦ (OCR happens locally in your browser)';
      csvOut.value = '';
      try {
        const raw = await runOcr(file);
        const cleaned = maybeNormalize(raw);
        ocrOut.value = cleaned || '(No text recognized)';
        const csv = buildCsvFromText(cleaned);
        csvOut.value = csv;
        window.lastCsvBlob = new Blob([csv], { type: 'text/csv' });
        setCredits(getCredits() - 1);
        alert('Conversion complete! Download ready.');
      } catch (e) {
        console.error(e);
        if (!/PDF not supported/.test(String(e))) {
          alert(e.message || 'Conversion failed.');
        }
      }
    }

    // Buttons / inputs
    document.getElementById('convertButton').addEventListener('click', doConvert);
    fileInput.addEventListener('change', () => { showFileName(); doConvert(); });

    document.getElementById('downloadCsvButton').addEventListener('click', () => {
      if (!window.lastCsvBlob) { alert('No CSV available yet.'); return; }
      const url = URL.createObjectURL(window.lastCsvBlob);
      const a = document.createElement('a');
      a.href = url; a.download = 'locallyconvert.csv'; a.click();
      URL.revokeObjectURL(url);
    });

    // Optional: wire up bulk credits checkout if your backend exists
    document.getElementById('buyCreditsBtn').addEventListener('click', async () => {
      try {
        const pack = 50;
        const r = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pack })
        });
        const { url, error } = await r.json();
        if (error || !url) throw new Error(error || 'Checkout not configured.');
        window.location = url;
      } catch (e) {
        alert(e.message || 'Could not start checkout.');
      }
    });

    /* Drag & drop */
    const dz = document.getElementById('dropzone');
    ['dragenter','dragover'].forEach(ev =>
      dz.addEventListener(ev, e => { e.preventDefault(); dz.style.borderColor='#b1cff0'; })
    );
    ['dragleave','drop'].forEach(ev =>
      dz.addEventListener(ev, e => { e.preventDefault(); dz.style.borderColor='#c8d9ee'; })
    );
    dz.addEventListener('drop', e => {
      const f = e.dataTransfer?.files?.[0];
      if (f) {
        const dt = new DataTransfer();
        dt.items.add(f);
        fileInput.files = dt.files;
        fileInput.dispatchEvent(new Event('change')); // show name + auto-convert
      }
    });
  </script>
</body>
</html>

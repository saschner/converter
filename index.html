<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Receipt to Excel — Private, In-Browser OCR</title>
  <meta name="description" content="Convert receipts to Excel-ready CSV/XLSX in your browser. 100% private — nothing uploaded." />
  <meta name="theme-color" content="#0b1420" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg:#0b1420;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --green:#10b981;
      --red:#ef4444;
      --yellow:#f59e0b;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.10);
      --pane-width:320px;
      --pane-height:110px;
      --pane-gap:18px;
    }

    html, body {
      margin:0;
      padding:0;
      height:100%;
      font-family:"Montserrat", sans-serif;
      color:var(--text);
      background:url("background.png") no-repeat center center fixed, var(--bg);
      background-size:cover;
      overflow-x:hidden;
    }

    /* Header layout */
    .header {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:18px;
      padding-top:32px;
      flex-wrap:wrap;
      text-align:center;
    }

    .header img {
      max-height:80px;
      height:auto;
    }
    .header img.lady {
      width:90px;
      height:auto;
      border-radius:50%;
      object-fit:cover;
      box-shadow:0 0 0 3px rgba(255,255,255,0.8);
    }

    /* White card */
    .wrap {
      display:flex;
      justify-content:center;
      padding:30px 20px 50px;
    }
    .card {
      width:100%;
      max-width:640px;
      background:var(--card);
      border-radius:20px;
      box-shadow:var(--shadow);
      padding:30px 26px;
      text-align:center;
      backdrop-filter:blur(4px);
    }

    h1 {
      font-weight:400;
      font-size:1.9rem;
      margin:0 0 10px;
      color:var(--text);
    }
    h3 {
      font-weight:400;
      font-size:1.1rem;
      margin:0 0 20px;
      color:var(--muted);
    }

    .credits-bubble {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:.95rem;
      font-weight:500;
      margin:14px auto 10px;
      padding:8px 14px;
      border:2px dotted #99c2ff;
      border-radius:16px;
      background:rgba(235,247,255,0.55);
      width:fit-content;
    }
    .credits-bubble .free{color:#065f46;}
    .credits-bubble .paid{color:#7f1d1d;cursor:pointer;}
    .credits-bubble a{color:var(--accent);text-decoration:none;}
    .credits-bubble a:hover{text-decoration:underline;}

    .drop {
      border:1.5px dashed #cbd5e1;
      background:#f8fafc;
      border-radius:14px;
      padding:10px;
      color:#475569;
    }
    .drop input{display:none;}
    .dz-btn {
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      border:1px solid #cfe1f7;
      background:#e9f4ff;
      color:#1e3a8a;
      padding:10px 24px;
      border-radius:10px;
      cursor:pointer;
      font-weight:500;
      font-size:1rem;
    }
    .tip { margin-top:6px; font-size:.85rem; color:#64748b; }

    .actions {
      display:flex;
      justify-content:center;
      margin:16px 0 8px;
    }
    .btn {
      border:none;
      border-radius:12px;
      padding:12px 16px;
      font-weight:500;
      cursor:pointer;
      box-shadow:0 1px 0 rgba(0,0,0,.06);
      font-size:1rem;
      background:var(--green);
      color:#063;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(2,minmax(0,var(--pane-width)));
      justify-content:center;
      gap:var(--pane-gap);
      margin-top:12px;
      align-items:start;
    }
    .grid>div {
      display:flex;
      flex-direction:column;
      min-width:0;
      padding:10px;
      border:2px dotted #99c2ff;
      border-radius:16px;
      background:rgba(235,247,255,0.55);
      box-sizing:border-box;
    }
    .grid h3 {
      margin:6px 0 8px;
      font-size:1.05rem;
      color:var(--text);
      text-align:center;
      font-weight:400;
    }
    textarea {
      flex:1;
      width:100%;
      min-height:var(--pane-height);
      border:none;
      background:transparent;
      color:#111827;
      padding:8px;
      resize:vertical;
      font-size:13px;
      box-sizing:border-box;
      font-family:"Montserrat", sans-serif;
    }

    footer {
      margin-top:20px;
      text-align:center;
      color:#6b7280;
      font-size:13px;
    }

    @media(max-width:520px){
      .header img{max-height:60px;}
      .header img.lady{width:70px;}
      .card{padding:22px 16px;}
      h1{font-size:1.6rem;}
      h3{font-size:1rem;}
      .grid{grid-template-columns:1fr;}
      textarea{min-height:120px;}
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <img src="LocallyConvert2.png" alt="Locally Convert">
    <img src="secret.png" alt="in Secret" class="lady">
  </div>

  <!-- Card -->
  <main class="wrap">
    <section class="card" id="mainContainer">
   <div class="header">
    <img src="LocallyConvert2.png" alt="Locally Convert">
    <img src="secret.png" alt="in Secret" class="lady">
  </div>
      <h1>Turn Receipts into Excel in Seconds</h1>
      <h3>No uploads. 100% private. Runs entirely in your browser.</h3>

      <div class="credits-bubble">
        <span class="free">Free Credits: 5</span>
        <span class="paid" id="creditsBadge">Paid Credits: 0</span>
        <a href="#" id="buyCreditsLink">Get Credits</a>
      </div>

      <div class="drop" id="dropzone">
        <input type="file" id="fileInput" accept="image/*,application/pdf" />
        <label for="fileInput" class="dz-btn">⋮⋮⋮⋮ Choose an image or PDF</label>
        <div class="tip" id="fileName"></div>
        <div class="tip">Tip: Use a clear, high-contrast image for best results.</div>
      </div>

      <div class="actions">
        <button id="convertButton" class="btn">Convert to Excel</button>
      </div>

      <div class="grid">
        <div>
          <h3>Receipt to Text</h3>
          <textarea id="ocrOut" placeholder="Recognized text will appear here…"></textarea>
        </div>
        <div>
          <h3>Excel Format Preview</h3>
          <textarea id="csvOut" placeholder="Formatted CSV will appear here…"></textarea>
        </div>
      </div>

      <footer>
        <p><img src="Gold-Shields.png" alt="trust badges" style="height:24px;vertical-align:middle;"><br>© 2025 AlphaMinds AI. All rights reserved.</p>
      </footer>
    </section>
  </main>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

  <script>
    function getCredits(){return Number(localStorage.getItem('lcCredits')||0);}
    function setCredits(n){localStorage.setItem('lcCredits',String(n));document.getElementById('creditsBadge').textContent='Paid Credits: '+n;}
    window.addEventListener('DOMContentLoaded',()=>{if(getCredits()===0)setCredits(50);else setCredits(getCredits());});

    const fileInput=document.getElementById('fileInput');
    const ocrOut=document.getElementById('ocrOut');
    const csvOut=document.getElementById('csvOut');

    function showFileName(){const el=document.getElementById('fileName');const f=fileInput?.files?.[0];el.textContent=f?`Selected: ${f.name}`:'';}

    async function runOcr(file){
      if(file.type==='application/pdf'){alert('PDFs supported soon. Use an image for now.');throw new Error('PDF not supported');}
      const worker=await Tesseract.createWorker('eng');
      try{const{data}=await worker.recognize(file);return data.text||'';}finally{await worker.terminate();}
    }

    function buildCsvFromText(t){
      const lines=t.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const rows=lines.map(l=>{
        const norm=l.replace(/\t+/g,' || ').replace(/\s{3,}/g,' || ').trim();
        const cells=norm.split(' || ').map(c=>c.trim()).filter(c=>c.length);
        return cells.map(c=>/[",\n]/.test(c)?'"'+c.replace(/"/g,'""')+'"':c).join(',');
      });
      return rows.join('\n');
    }

    async function doConvert(){
      if(!fileInput.files.length)return alert('Please select a file first.');
      if(getCredits()<=0)return alert('You need credits.');
      const file=fileInput.files[0];
      ocrOut.value='Working…';
      csvOut.value='';
      try{
        const raw=await runOcr(file);
        ocrOut.value=raw||'(No text recognized)';
        const csv=buildCsvFromText(raw);
        csvOut.value=csv;
        window.lastCsvBlob=new Blob([csv],{type:'text/csv'});
        setCredits(getCredits()-1);
        // automatically trigger download
        const url=URL.createObjectURL(window.lastCsvBlob);
        const a=document.createElement('a');
        a.href=url;a.download='receipt-to-excel.csv';a.click();
        URL.revokeObjectURL(url);
        alert('Conversion complete! File downloaded.');
      }catch(e){alert(e.message||'Conversion failed.');}
    }

    document.getElementById('convertButton').onclick=()=>{showFileName();doConvert();};
    fileInput.onchange=()=>{showFileName();};
  </script>
</body>
</html>
